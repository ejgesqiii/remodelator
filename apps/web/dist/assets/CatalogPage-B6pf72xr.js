import{c as F,b as N,u as U,j as e}from"./query-BVapmMUr.js";import{r as o}from"./react-DJjQTIQO.js";import{P as D}from"./PageHeader-o_TcEL5P.js";import{E as $}from"./EmptyState-CZ0oPKrL.js";import{M as K}from"./MoneyDisplay-DJnLbf4O.js";import{c as M}from"./cn-C8nBGPD0.js";import{u as Q,g as T,s as A}from"./catalog-izJKRsF9.js";import{P as C,l as R,m as H,X as L,q as B,v as X,I as G,s as J,t as w}from"./ui--RxPHpVv.js";import"./client-DPKpE0-G.js";import"./index-CwauQ0k6.js";import"./state-B9IHhQuw.js";function O(i,u=300){const[p,t]=o.useState(i);return o.useEffect(()=>{const g=setTimeout(()=>t(i),u);return()=>clearTimeout(g)},[i,u]),p}function ie(){const i=F(),[u,p]=o.useState(""),t=O(u,300),[g,S]=o.useState(new Set),[n,_]=o.useState(null),[k,h]=o.useState(!1),[b,f]=o.useState(null),[r,l]=o.useState({name:"",unit_price:"",labor_hours:"",category:""}),{data:m=[],isLoading:E}=N({queryKey:["catalog-tree"],queryFn:T}),{data:z}=N({queryKey:["catalog-search",t],queryFn:()=>A(t),enabled:t.length>=2}),y=U({mutationFn:s=>Q(s),onSuccess:()=>{i.invalidateQueries({queryKey:["catalog-tree"]}),i.invalidateQueries({queryKey:["catalog-search"]}),w.success(b?"Item updated":"Item added"),j()},onError:s=>w.error(s instanceof Error?s.message:"Failed")}),j=()=>{h(!1),f(null),l({name:"",unit_price:"",labor_hours:"",category:""})},P=s=>{f(s),l({name:s.name,unit_price:s.unit_price,labor_hours:s.labor_hours,category:""}),h(!0)},q=s=>{S(c=>{const d=new Set(c);return d.has(s)?d.delete(s):d.add(s),d})},I=o.useMemo(()=>{if(!n)return[];const s=m.find(c=>c.name===n);return(s==null?void 0:s.items)||[]},[n,m]),a=t.length>=2?z:n?I:void 0,x="w-full rounded-xl border border-input-border bg-input px-3 py-2.5 text-sm outline-none transition-colors focus:border-primary focus:ring-2 focus:ring-primary/20";return e.jsxs("div",{className:"space-y-6",children:[e.jsx(D,{title:"Catalog",description:"Browse and manage remodeling items",icon:C,actions:e.jsxs("button",{onClick:()=>{f(null),h(!0)},className:"flex items-center gap-2 rounded-xl bg-primary px-4 py-2.5 text-sm font-semibold text-primary-foreground shadow-lg shadow-primary/20 hover:bg-primary-hover",children:[e.jsx(R,{size:18})," Add Item"]})}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{size:18,className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-muted"}),e.jsx("input",{value:u,onChange:s=>p(s.target.value),placeholder:"Search catalog items...",className:"w-full rounded-xl border border-input-border bg-input py-2.5 pl-10 pr-4 text-sm placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-border bg-surface p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-lg font-semibold",children:b?"Edit Item":"Add Catalog Item"}),e.jsx("button",{onClick:j,className:"rounded-lg bg-transparent p-1.5 text-muted shadow-none hover:bg-surface-hover hover:text-foreground",children:e.jsx(L,{size:18})})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),y.mutate({name:r.name,unit_price:parseFloat(r.unit_price)||0,labor_hours:parseFloat(r.labor_hours)||0,category:r.category||void 0})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Item Name *"}),e.jsx("input",{value:r.name,onChange:s=>l({...r,name:s.target.value}),required:!0,className:x})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Unit Price ($)"}),e.jsx("input",{type:"number",step:"0.01",value:r.unit_price,onChange:s=>l({...r,unit_price:s.target.value}),className:x})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Labor Hours"}),e.jsx("input",{type:"number",step:"0.25",value:r.labor_hours,onChange:s=>l({...r,labor_hours:s.target.value}),className:x})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Category"}),e.jsxs("select",{value:r.category,onChange:s=>l({...r,category:s.target.value}),className:x,children:[e.jsx("option",{value:"",children:"Uncategorized"}),m.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsxs("button",{type:"submit",disabled:y.isPending,className:"flex flex-1 items-center justify-center gap-2 rounded-xl bg-primary px-4 py-3 text-sm font-semibold text-primary-foreground shadow-lg shadow-primary/20 hover:bg-primary-hover disabled:opacity-50",children:[y.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary-foreground/30 border-t-primary-foreground"}):e.jsx(B,{size:16}),b?"Update":"Add"]}),e.jsx("button",{type:"button",onClick:j,className:"rounded-xl bg-transparent px-4 py-3 text-sm text-muted-foreground shadow-none hover:text-foreground",children:"Cancel"})]})]})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-border bg-surface/80 p-5 backdrop-blur-sm",children:[e.jsx("h2",{className:"mb-4 font-heading text-base font-semibold",children:"Categories"}),E?e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(s=>e.jsx("div",{className:"animate-skeleton h-8 rounded-lg bg-border"},s))}):m.length===0?e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No categories yet"}):e.jsx("div",{className:"space-y-0.5",children:m.map(s=>{const c=g.has(s.name),d=n===s.name;return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{q(s.name),_(s.name),p("")},className:M("flex w-full items-center gap-2 rounded-xl px-3 py-2.5 text-left text-sm font-medium transition-colors",d?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-surface-hover hover:text-foreground"),children:[c?e.jsx(X,{size:14}):e.jsx(G,{size:14}),e.jsx("span",{className:"flex-1 truncate",children:s.name}),e.jsx("span",{className:"shrink-0 rounded-full bg-surface-active px-2 py-0.5 text-xs",children:s.items.length})]}),c&&s.items.length>0&&e.jsx("div",{className:"ml-5 mt-0.5 space-y-0.5 border-l border-border pl-3",children:s.items.map(v=>e.jsx("p",{className:"truncate py-1 text-xs text-muted-foreground",children:v.name},v.id))})]},s.name)})})]}),e.jsxs("div",{className:"rounded-2xl border border-border bg-surface/80 p-5 backdrop-blur-sm lg:col-span-2",children:[e.jsx("h2",{className:"mb-4 font-heading text-base font-semibold",children:t.length>=2?`Search: "${t}" (${(a==null?void 0:a.length)||0})`:n?`${n} (${(a==null?void 0:a.length)||0})`:"Items"}),a&&a.length>0?e.jsx("div",{className:"space-y-2",children:a.map(s=>e.jsxs("div",{className:"group flex items-center justify-between rounded-xl border border-border bg-background/50 px-4 py-3 transition-colors hover:bg-surface-hover",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),"labor_hours"in s&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.labor_hours,"h labor"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:["unit_price"in s&&e.jsx(K,{value:s.unit_price,size:"sm"}),"unit_price"in s&&e.jsx("button",{onClick:()=>P(s),className:"rounded-lg bg-transparent p-1.5 text-muted opacity-0 shadow-none transition-all group-hover:opacity-100 hover:bg-surface-active hover:text-foreground","aria-label":"Edit item",children:e.jsx(J,{size:14})})]})]},s.id))}):e.jsx($,{icon:C,title:t.length>=2?"No matching items":"Select a category",description:t.length>=2?"Try different search terms":"Choose a category from the tree to view its items"})]})]})]})}export{ie as CatalogPage};
