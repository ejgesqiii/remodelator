import{c as g,u as x,j as e,b as j}from"./query-BVapmMUr.js";import{u as N,o as v,n as c,s as _}from"./forms-BaqsNbdS.js";import{a as k}from"./zod-Dxxgtj27.js";import{P as w}from"./PageHeader-o_TcEL5P.js";import{a as S,g as h,p as R}from"./client-DPKpE0-G.js";import{t as l,N as E,D as F,O as b,p as P,g as y,X as C,S as D,q as z}from"./ui--RxPHpVv.js";import{r as f}from"./react-DJjQTIQO.js";import"./index-CwauQ0k6.js";import"./state-B9IHhQuw.js";function q(){return h("/profile")}function B(o){return S("/profile",o)}function M(){return h("/backup/export")}function O(o){return R("/backup/restore",o)}function U(){const o=g(),[s,d]=f.useState(null),[m,t]=f.useState(!1),u=x({mutationFn:M,onSuccess:r=>{const a=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),i=URL.createObjectURL(a),p=document.createElement("a");p.href=i,p.download=`remodelator-backup-${new Date().toISOString().slice(0,10)}.json`,p.click(),URL.revokeObjectURL(i),l.success("Backup exported")},onError:r=>l.error(r instanceof Error?r.message:"Export failed")}),n=x({mutationFn:async()=>{if(!s)throw new Error("No file selected");const r=await s.text(),a=JSON.parse(r);return O(a)},onSuccess:r=>{o.invalidateQueries(),l.success(`Restored ${r.estimates_restored} estimates, ${r.line_items_restored} line items`),t(!1),d(null)},onError:r=>l.error(r instanceof Error?r.message:"Restore failed")});return e.jsxs("div",{className:"rounded-2xl border border-border bg-surface/80 p-6 backdrop-blur-sm",children:[e.jsxs("h2",{className:"mb-4 flex items-center gap-2 font-heading text-base font-semibold",children:[e.jsx(E,{size:18,className:"text-muted"}),"Data Backup"]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-border bg-background/50 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Export Snapshot"}),e.jsx("p",{className:"mb-3 text-xs text-muted-foreground",children:"Download a JSON backup of all your estimates and line items."}),e.jsxs("button",{onClick:()=>u.mutate(),disabled:u.isPending,className:"flex items-center gap-2 rounded-xl bg-primary px-4 py-2.5 text-sm font-semibold text-primary-foreground shadow-md transition-all hover:bg-primary-hover disabled:opacity-50",children:[u.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary-foreground/30 border-t-primary-foreground"}):e.jsx(F,{size:16}),"Export"]})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-background/50 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Restore from Backup"}),m?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"file",accept:".json",onChange:r=>{var a;return d(((a=r.target.files)==null?void 0:a[0])||null)},className:"w-full text-sm text-muted-foreground file:mr-2 file:rounded-lg file:border-0 file:bg-primary/10 file:px-3 file:py-1.5 file:text-xs file:font-medium file:text-primary"}),s&&e.jsxs("p",{className:"flex items-center gap-1.5 text-xs text-success",children:[e.jsx(P,{size:12})," ",s.name]}),e.jsxs("div",{className:"flex items-center gap-1.5 rounded-xl border border-warning/30 bg-warning-muted px-3 py-2 text-xs text-warning",children:[e.jsx(y,{size:12,className:"shrink-0"}),"This will merge data — existing records will not be deleted."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>n.mutate(),disabled:!s||n.isPending,className:"flex items-center gap-2 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground shadow-md transition-all hover:bg-primary-hover disabled:opacity-50",children:[n.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary-foreground/30 border-t-primary-foreground"}):e.jsx(b,{size:14}),"Confirm Restore"]}),e.jsx("button",{onClick:()=>{t(!1),d(null)},className:"rounded-xl bg-transparent px-3 py-2 text-sm text-muted-foreground shadow-none hover:text-foreground",children:e.jsx(C,{size:14})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-3 text-xs text-muted-foreground",children:"Upload a previously exported snapshot to restore data."}),e.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 rounded-xl border border-border bg-surface-hover px-4 py-2.5 text-sm font-medium text-foreground shadow-none transition-colors hover:bg-surface-active",children:[e.jsx(b,{size:16})," Restore"]})]})]})]})]})}const L=v({full_name:_().min(1,"Name is required"),labor_rate:c().min(0).optional(),item_markup_pct:c().min(0).optional(),estimate_markup_pct:c().min(0).optional(),tax_rate_pct:c().min(0).optional()});function G(){const o=g(),{data:s,isLoading:d}=j({queryKey:["profile"],queryFn:q}),m=x({mutationFn:B,onSuccess:()=>{o.invalidateQueries({queryKey:["profile"]}),l.success("Profile updated")},onError:i=>l.error(i instanceof Error?i.message:"Update failed")}),{register:t,handleSubmit:u,formState:{errors:n,isDirty:r}}=N({resolver:k(L),values:s?{full_name:s.full_name,labor_rate:parseFloat(s.labor_rate)||0,item_markup_pct:parseFloat(s.default_item_markup_pct)||0,estimate_markup_pct:parseFloat(s.default_estimate_markup_pct)||0,tax_rate_pct:parseFloat(s.tax_rate_pct)||0}:void 0}),a=i=>{m.mutate(i)};return d?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"animate-skeleton h-10 w-1/3 rounded-xl bg-border"}),e.jsx("div",{className:"animate-skeleton h-64 rounded-2xl bg-border"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{title:"Settings",description:"Manage your profile and defaults",icon:D}),e.jsx("div",{className:"max-w-2xl",children:e.jsxs("div",{className:"rounded-2xl border border-border bg-surface/80 p-6 backdrop-blur-sm",children:[e.jsx("h2",{className:"mb-4 font-heading text-base font-semibold",children:"Profile & Defaults"}),e.jsxs("form",{onSubmit:u(a),className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Full Name"}),e.jsx("input",{...t("full_name"),className:"w-full rounded-xl border border-input-border bg-input px-4 py-3 text-sm placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"}),n.full_name&&e.jsxs("p",{className:"flex items-center gap-1.5 text-xs text-destructive",children:[e.jsx(y,{size:12}),n.full_name.message]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Default Labor Rate ($/hr)"}),e.jsx("input",{type:"number",step:"0.01",...t("labor_rate",{valueAsNumber:!0}),className:"w-full rounded-xl border border-input-border bg-input px-4 py-3 text-sm placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Default Item Markup %"}),e.jsx("input",{type:"number",step:"0.01",...t("item_markup_pct",{valueAsNumber:!0}),className:"w-full rounded-xl border border-input-border bg-input px-4 py-3 text-sm placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Default Estimate Markup %"}),e.jsx("input",{type:"number",step:"0.01",...t("estimate_markup_pct",{valueAsNumber:!0}),className:"w-full rounded-xl border border-input-border bg-input px-4 py-3 text-sm placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tax Rate %"}),e.jsx("input",{type:"number",step:"0.01",...t("tax_rate_pct",{valueAsNumber:!0}),className:"w-full rounded-xl border border-input-border bg-input px-4 py-3 text-sm placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"submit",disabled:!r||m.isPending,className:"flex items-center gap-2 rounded-xl bg-primary px-5 py-2.5 text-sm font-semibold text-primary-foreground shadow-lg shadow-primary/20 transition-all hover:bg-primary-hover disabled:opacity-50",children:[m.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary-foreground/30 border-t-primary-foreground"}):e.jsx(z,{size:16}),"Save Changes"]}),s&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.email," • ",s.role]})]})]})]})}),e.jsx(U,{})]})}export{G as SettingsPage};
