import{c as g,b as m,u as h,j as e}from"./query-BVapmMUr.js";import{r as p}from"./react-DJjQTIQO.js";import{P as f}from"./PageHeader-o_TcEL5P.js";import{E as y,f as j}from"./EmptyState-CZ0oPKrL.js";import{p as v,g as N}from"./client-Bw5oB_ZD.js";import{l as w}from"./estimates-D7lOcU5t.js";import{F as o,J as c,k,X as C,t as u}from"./ui-D1pQdlX7.js";import"./index-D_Pr5PJx.js";import"./state-BAZDGeK2.js";function E(){return N("/templates")}function S(r){return v("/templates/apply",r)}function I(){const r=g(),[l,t]=p.useState(null),[a,n]=p.useState(""),{data:d=[],isLoading:x}=m({queryKey:["templates"],queryFn:E}),{data:b=[]}=m({queryKey:["estimates"],queryFn:w}),i=h({mutationFn:s=>S(s),onSuccess:()=>{r.invalidateQueries({queryKey:["estimates"]}),u.success("Template applied to estimate"),t(null),n("")},onError:s=>u.error(s instanceof Error?s.message:"Apply failed")});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(f,{title:"Templates",description:"Save and reuse estimate templates",icon:o}),x?e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(s=>e.jsxs("div",{className:"animate-skeleton rounded-2xl border border-border bg-surface/80 p-6",children:[e.jsx("div",{className:"mb-3 h-5 w-2/3 rounded bg-border"}),e.jsx("div",{className:"mb-2 h-4 w-1/2 rounded bg-border"}),e.jsx("div",{className:"h-4 w-1/3 rounded bg-border"})]},s))}):d.length===0?e.jsx(y,{icon:o,title:"No templates yet",description:"Save an estimate as a template to reuse it later. Templates preserve all line items and can be applied to new estimates."}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:d.map(s=>e.jsxs("div",{className:"group rounded-2xl border border-border bg-surface/80 p-6 backdrop-blur-sm transition-all hover:border-primary/20 hover:bg-surface-hover",children:[e.jsxs("div",{className:"mb-3 flex items-start justify-between",children:[e.jsx("h3",{className:"font-heading text-base font-semibold group-hover:text-primary",children:s.name}),e.jsx("button",{onClick:()=>t(s.id),className:"rounded-lg bg-primary/10 p-2 text-primary shadow-none transition-colors hover:bg-primary/20","aria-label":`Apply template ${s.name}`,children:e.jsx(c,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(o,{size:14,className:"text-muted"}),e.jsxs("span",{children:[s.line_item_count," line items"]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-muted",children:[e.jsx(k,{size:12}),e.jsx("span",{children:j(s.created_at)})]})]},s.id))}),l&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-border bg-surface p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-lg font-semibold",children:"Apply Template"}),e.jsx("button",{onClick:()=>t(null),className:"rounded-lg bg-transparent p-1.5 text-muted shadow-none hover:bg-surface-hover hover:text-foreground",children:e.jsx(C,{size:18})})]}),e.jsx("p",{className:"mb-4 text-sm text-muted-foreground",children:"Select an estimate to apply template line items to."}),e.jsxs("select",{value:a,onChange:s=>n(s.target.value),className:"mb-4 w-full rounded-xl border border-input-border bg-input px-4 py-3 text-sm outline-none focus:border-primary focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"",children:"Choose an estimate..."}),b.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>i.mutate({template_id:l,estimate_id:a}),disabled:!a||i.isPending,className:"flex flex-1 items-center justify-center gap-2 rounded-xl bg-primary px-4 py-3 text-sm font-semibold text-primary-foreground shadow-lg shadow-primary/20 hover:bg-primary-hover disabled:opacity-50",children:[i.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary-foreground/30 border-t-primary-foreground"}):e.jsx(c,{size:16}),"Apply"]}),e.jsx("button",{onClick:()=>t(null),className:"rounded-xl bg-transparent px-4 py-3 text-sm text-muted-foreground shadow-none hover:text-foreground",children:"Cancel"})]})]})})]})}export{I as TemplateListPage};
