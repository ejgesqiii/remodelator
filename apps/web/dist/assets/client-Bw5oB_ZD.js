var d=Object.defineProperty;var h=(t,e,n)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var i=(t,e,n)=>h(t,typeof e!="symbol"?e+"":e,n);import{u as p}from"./index-D_Pr5PJx.js";import{c as A}from"./state-BAZDGeK2.js";const f=A(t=>({adminApiKey:"",setAdminApiKey:e=>t({adminApiKey:e}),clearAdminApiKey:()=>t({adminApiKey:""})})),l="http://localhost:8000";class S extends Error{constructor(n,r){var a,s;const c=((a=r==null?void 0:r.error)==null?void 0:a.message)||(r==null?void 0:r.detail)||"An unexpected error occurred";super(c);i(this,"status");i(this,"code");i(this,"requestId");this.name="ApiError",this.status=n,this.code=((s=r==null?void 0:r.error)==null?void 0:s.code)||"unknown_error",this.requestId=r==null?void 0:r.request_id}}function E(t){const[e]=t.split("?");return e}function g(t,e){const n=E(t);return e.toUpperCase()!=="POST"?!1:n==="/admin/demo-reset"||n==="/admin/audit-prune"}async function u(t,e){const n=p.getState().token,r=f.getState().adminApiKey.trim(),c=((e==null?void 0:e.method)??"GET").toUpperCase(),a={"Content-Type":"application/json",...n?{"x-session-token":n}:{},...r&&g(t,c)?{"x-admin-key":r}:{},...e==null?void 0:e.headers},s=await fetch(`${l}${t}`,{...e,headers:a});if(!s.ok){const m=await s.json().catch(()=>({detail:s.statusText}));throw new S(s.status,m)}const o=await s.text();return o?JSON.parse(o):{}}function k(t){return u(t,{method:"GET"})}function w(t,e){return u(t,{method:"POST",body:e!==void 0?JSON.stringify(e):void 0})}function P(t,e){return u(t,{method:"PUT",body:e!==void 0?JSON.stringify(e):void 0})}function q(t){return u(t,{method:"DELETE"})}export{P as a,q as d,k as g,w as p,f as u};
