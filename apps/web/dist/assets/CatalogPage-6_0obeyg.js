import{c as U,b as N,u as M,j as e}from"./query-BVapmMUr.js";import{r as n}from"./react-DJjQTIQO.js";import{P as $}from"./PageHeader-o_TcEL5P.js";import{E as A}from"./EmptyState-CZ0oPKrL.js";import{M as D}from"./MoneyDisplay-DJnLbf4O.js";import{c as K}from"./cn-C8nBGPD0.js";import{u as Q,a as R,g as B,s as H}from"./useDebounce-D14sap1U.js";import{u as L}from"./index-D_Pr5PJx.js";import{P as C,l as T,m as X,X as G,q as J,u as O,v as V,s as W,t as w}from"./ui-D1pQdlX7.js";import"./client-Bw5oB_ZD.js";import"./state-BAZDGeK2.js";function de(){const f=U(),u=L(s=>s.role)==="admin",[y,j]=n.useState(""),a=Q(y,300),[S,_]=n.useState(new Set),[o,k]=n.useState(null),[E,p]=n.useState(!1),[x,g]=n.useState(null),[r,l]=n.useState({name:"",unit_price:"",labor_hours:"",category:""}),{data:d=[],isLoading:z}=N({queryKey:["catalog-tree"],queryFn:B}),{data:P}=N({queryKey:["catalog-search",a],queryFn:()=>H(a),enabled:a.length>=2}),h=M({mutationFn:s=>R(s),onSuccess:()=>{f.invalidateQueries({queryKey:["catalog-tree"]}),f.invalidateQueries({queryKey:["catalog-search"]}),w.success(x?"Item updated":"Item added"),b()},onError:s=>w.error(s instanceof Error?s.message:"Failed")}),b=()=>{p(!1),g(null),l({name:"",unit_price:"",labor_hours:"",category:""})},q=s=>{g(s),l({name:s.name,unit_price:s.unit_price,labor_hours:s.labor_hours,category:""}),p(!0)},F=s=>{_(i=>{const c=new Set(i);return c.has(s)?c.delete(s):c.add(s),c})},I=n.useMemo(()=>{if(!o)return[];const s=d.find(i=>i.name===o);return(s==null?void 0:s.items)||[]},[o,d]),t=a.length>=2?P:o?I:void 0,m="w-full rounded-xl border border-input-border bg-input px-3 py-2.5 text-sm outline-none transition-colors focus:border-primary focus:ring-2 focus:ring-primary/20";return e.jsxs("div",{className:"space-y-6",children:[e.jsx($,{title:"Catalog",description:u?"Browse and manage remodeling items":"Browse remodeling items (catalog management is admin-only)",icon:C,actions:u?e.jsxs("button",{onClick:()=>{g(null),p(!0)},className:"flex items-center gap-2 rounded-xl bg-primary px-4 py-2.5 text-sm font-semibold text-primary-foreground shadow-lg shadow-primary/20 hover:bg-primary-hover",children:[e.jsx(T,{size:18})," Add Item"]}):null}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{size:18,className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-muted"}),e.jsx("input",{value:y,onChange:s=>j(s.target.value),placeholder:"Search catalog items...",className:"w-full rounded-xl border border-input-border bg-input py-2.5 pl-10 pr-4 text-sm placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),u&&E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-border bg-surface p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading text-lg font-semibold",children:x?"Edit Item":"Add Catalog Item"}),e.jsx("button",{onClick:b,className:"rounded-lg bg-transparent p-1.5 text-muted shadow-none hover:bg-surface-hover hover:text-foreground",children:e.jsx(G,{size:18})})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),h.mutate({name:r.name,unit_price:parseFloat(r.unit_price)||0,labor_hours:parseFloat(r.labor_hours)||0,category:r.category||void 0})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Item Name *"}),e.jsx("input",{value:r.name,onChange:s=>l({...r,name:s.target.value}),required:!0,className:m})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Unit Price ($)"}),e.jsx("input",{type:"number",step:"0.01",value:r.unit_price,onChange:s=>l({...r,unit_price:s.target.value}),className:m})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Labor Hours"}),e.jsx("input",{type:"number",step:"0.25",value:r.labor_hours,onChange:s=>l({...r,labor_hours:s.target.value}),className:m})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Category"}),e.jsxs("select",{value:r.category,onChange:s=>l({...r,category:s.target.value}),className:m,children:[e.jsx("option",{value:"",children:"Uncategorized"}),d.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsxs("button",{type:"submit",disabled:h.isPending,className:"flex flex-1 items-center justify-center gap-2 rounded-xl bg-primary px-4 py-3 text-sm font-semibold text-primary-foreground shadow-lg shadow-primary/20 hover:bg-primary-hover disabled:opacity-50",children:[h.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary-foreground/30 border-t-primary-foreground"}):e.jsx(J,{size:16}),x?"Update":"Add"]}),e.jsx("button",{type:"button",onClick:b,className:"rounded-xl bg-transparent px-4 py-3 text-sm text-muted-foreground shadow-none hover:text-foreground",children:"Cancel"})]})]})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-border bg-surface/80 p-5 backdrop-blur-sm",children:[e.jsx("h2",{className:"mb-4 font-heading text-base font-semibold",children:"Categories"}),z?e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(s=>e.jsx("div",{className:"animate-skeleton h-8 rounded-lg bg-border"},s))}):d.length===0?e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No categories yet"}):e.jsx("div",{className:"space-y-0.5",children:d.map(s=>{const i=S.has(s.name),c=o===s.name;return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{F(s.name),k(s.name),j("")},className:K("flex w-full items-center gap-2 rounded-xl px-3 py-2.5 text-left text-sm font-medium transition-colors",c?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-surface-hover hover:text-foreground"),children:[i?e.jsx(O,{size:14}):e.jsx(V,{size:14}),e.jsx("span",{className:"flex-1 truncate",children:s.name}),e.jsx("span",{className:"shrink-0 rounded-full bg-surface-active px-2 py-0.5 text-xs",children:s.items.length})]}),i&&s.items.length>0&&e.jsx("div",{className:"ml-5 mt-0.5 space-y-0.5 border-l border-border pl-3",children:s.items.map(v=>e.jsx("p",{className:"truncate py-1 text-xs text-muted-foreground",children:v.name},v.id))})]},s.name)})})]}),e.jsxs("div",{className:"rounded-2xl border border-border bg-surface/80 p-5 backdrop-blur-sm lg:col-span-2",children:[e.jsx("h2",{className:"mb-4 font-heading text-base font-semibold",children:a.length>=2?`Search: "${a}" (${(t==null?void 0:t.length)||0})`:o?`${o} (${(t==null?void 0:t.length)||0})`:"Items"}),t&&t.length>0?e.jsx("div",{className:"space-y-2",children:t.map(s=>e.jsxs("div",{className:"group flex items-center justify-between rounded-xl border border-border bg-background/50 px-4 py-3 transition-colors hover:bg-surface-hover",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),"labor_hours"in s&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.labor_hours,"h labor"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:["unit_price"in s&&e.jsx(D,{value:s.unit_price,size:"sm"}),"unit_price"in s&&u&&e.jsx("button",{onClick:()=>q(s),className:"rounded-lg bg-transparent p-1.5 text-muted opacity-0 shadow-none transition-all group-hover:opacity-100 hover:bg-surface-active hover:text-foreground","aria-label":"Edit item",children:e.jsx(W,{size:14})})]})]},s.id))}):e.jsx(A,{icon:C,title:a.length>=2?"No matching items":"Select a category",description:a.length>=2?"Try different search terms":"Choose a category from the tree to view its items"})]})]})]})}export{de as CatalogPage};
