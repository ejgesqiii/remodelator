import{c as S,b as u,u as b,j as e}from"./query-BVapmMUr.js";import{r as f}from"./react-DJjQTIQO.js";import{P as _}from"./PageHeader-o_TcEL5P.js";import{S as w,a as d}from"./LoadingSkeleton-QY-c1bum.js";import{S as h}from"./StatusBadge-DqFGVLZ6.js";import{b as k,E as p,f as C}from"./EmptyState-CZ0oPKrL.js";import{p as y,g as m}from"./client-CZB5FU-Z.js";import{c as P,Q as v,C as R,P as q,b as E,V as A,g as D,R as L,w as T,t as a}from"./ui--RxPHpVv.js";import"./cn-C8nBGPD0.js";import"./index-CLC1XlwA.js";import"./state-B9IHhQuw.js";function U(){return m("/admin/summary")}function $(s){const i=new URLSearchParams().toString();return m(`/admin/users${i?`?${i}`:""}`)}function F(s){const r=new URLSearchParams;r.set("limit",String(s.limit)),s!=null&&s.user_id&&r.set("user_id",s.user_id),s!=null&&s.action&&r.set("action",s.action),s!=null&&s.entity_type&&r.set("entity_type",s.entity_type);const i=r.toString();return m(`/admin/activity${i?`?${i}`:""}`)}function Q(s){const r=new URLSearchParams;r.set("retention_days",String(s.retention_days)),(s==null?void 0:s.dry_run)!==void 0&&r.set("dry_run",String(s.dry_run));const i=r.toString();return y(`/admin/audit-prune${i?`?${i}`:""}`)}function z(){return y("/admin/demo-reset")}function X(){const s=S(),[r,i]=f.useState(""),[x,j]=f.useState("90"),{data:n,isLoading:N}=u({queryKey:["admin-summary"],queryFn:U}),{data:o=[]}=u({queryKey:["admin-users"],queryFn:()=>$()}),{data:g=[]}=u({queryKey:["admin-activity"],queryFn:()=>F({limit:20})}),c=b({mutationFn:z,onSuccess:()=>{s.invalidateQueries(),a.success("Demo data reset"),i("")},onError:t=>a.error(t instanceof Error?t.message:"Reset failed")}),l=b({mutationFn:()=>Q({retention_days:parseInt(x)||90}),onSuccess:t=>{s.invalidateQueries({queryKey:["admin-activity"]}),a.success(`Pruned ${t.deleted} records`)},onError:t=>a.error(t instanceof Error?t.message:"Prune failed")});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{title:"Admin",description:"System administration and monitoring",icon:P}),N?e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(t=>e.jsx(w,{},t))}):n&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(d,{label:"Users",value:n.users,icon:v}),e.jsx(d,{label:"Estimates",value:n.estimates,icon:R}),e.jsx(d,{label:"Line Items",value:n.line_items,icon:q}),e.jsx(d,{label:"Billing Total",value:k(n.billing_total_amount),icon:E})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl border border-border bg-surface/80 p-6 backdrop-blur-sm",children:[e.jsxs("h2",{className:"mb-4 font-heading text-base font-semibold",children:["Users (",o.length,")"]}),o.length===0?e.jsx(p,{icon:v,title:"No users"}):e.jsx("div",{className:"max-h-80 space-y-2 overflow-y-auto",children:o.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-border bg-background/50 px-4 py-3 transition-colors hover:bg-surface-hover",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-sm font-medium",children:t.full_name||t.email}),t.stripe_subscription_id&&e.jsx("span",{className:"rounded bg-sky-500/10 px-1.5 py-0.5 text-[10px] font-medium text-sky-500 ring-1 ring-sky-500/20 ring-inset",children:"Stripe Sub"})]}),e.jsxs("div",{className:"mt-0.5 flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:t.email}),e.jsx(h,{status:t.role==="admin"?"active":"draft",className:"text-[10px]"})]}),t.stripe_customer_id&&e.jsx("p",{className:"font-mono text-[9px] text-muted-foreground/50",children:t.stripe_customer_id})]})]}),e.jsxs("div",{className:"shrink-0 text-right",children:[e.jsx("p",{className:"text-sm font-medium",children:t.estimates_count}),e.jsx("p",{className:"text-xs text-muted",children:"estimates"})]})]},t.id))})]}),e.jsxs("div",{className:"rounded-2xl border border-border bg-surface/80 p-6 backdrop-blur-sm",children:[e.jsx("h2",{className:"mb-4 font-heading text-base font-semibold",children:"Recent Activity"}),g.length===0?e.jsx(p,{icon:A,title:"No recent activity"}):e.jsx("div",{className:"max-h-80 space-y-1.5 overflow-y-auto",children:g.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-border bg-background/50 px-4 py-2.5 transition-colors hover:bg-surface-hover",children:[e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{status:t.action,size:"sm"}),e.jsxs("span",{className:"truncate text-xs text-muted-foreground",children:["on ",t.entity_type]})]})}),e.jsx("p",{className:"shrink-0 text-xs text-muted",children:C(t.created_at)})]},t.id))})]})]}),e.jsxs("div",{className:"rounded-2xl border border-destructive/30 bg-destructive-muted/30 p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(D,{size:18,className:"text-destructive"}),e.jsx("h2",{className:"font-heading text-base font-semibold text-destructive",children:"Danger Zone"})]}),e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-3 rounded-xl border border-destructive/20 bg-background/30 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Demo Reset"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Wipe all data and start fresh. Type "RESET" to confirm.'}),e.jsx("input",{value:r,onChange:t=>i(t.target.value),placeholder:'Type "RESET"',className:"w-full rounded-xl border border-input-border bg-input px-3 py-2 text-sm placeholder:text-muted outline-none focus:border-destructive focus:ring-2 focus:ring-destructive/20"}),e.jsxs("button",{onClick:()=>c.mutate(),disabled:r!=="RESET"||c.isPending,className:"flex w-full items-center justify-center gap-2 rounded-xl bg-destructive px-4 py-2.5 text-sm font-semibold text-destructive-foreground shadow-md hover:bg-destructive-hover disabled:opacity-30",children:[c.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-destructive-foreground/30 border-t-destructive-foreground"}):e.jsx(L,{size:14}),"Reset Demo"]})]}),e.jsxs("div",{className:"space-y-3 rounded-xl border border-destructive/20 bg-background/30 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Audit Prune"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Delete audit records older than retention days."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:x,onChange:t=>j(t.target.value),className:"w-full rounded-xl border border-input-border bg-input px-3 py-2 text-sm outline-none focus:border-destructive focus:ring-2 focus:ring-destructive/20"}),e.jsx("span",{className:"shrink-0 text-xs text-muted-foreground",children:"days"})]}),e.jsxs("button",{onClick:()=>l.mutate(),disabled:l.isPending,className:"flex w-full items-center justify-center gap-2 rounded-xl border border-destructive/30 bg-destructive/10 px-4 py-2.5 text-sm font-semibold text-destructive shadow-none hover:bg-destructive/20 disabled:opacity-30",children:[l.isPending?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-destructive/30 border-t-destructive"}):e.jsx(T,{size:14}),"Prune Audit"]})]})]})]})]})}export{X as AdminDashboardPage};
